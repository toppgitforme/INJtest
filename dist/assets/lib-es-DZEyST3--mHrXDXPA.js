import{S as M,e as L,f as A,g as X,_ as R,a as D}from"./lib-es-BdVxwK9Z-B9dpt8vi.js";import{L as W,r as G}from"./semver-DQp6anwM-IwHLRqB3.js";import{$ as m}from"./injective-utils-C9MYzl-J.js";var H=D({"../../../node_modules/.pnpm/events@3.3.0/node_modules/events/events.js":(r,c)=>{var a=typeof Reflect=="object"?Reflect:null,u=a&&typeof a.apply=="function"?a.apply:function(e,n,o){return Function.prototype.apply.call(e,n,o)},f;a&&typeof a.ownKeys=="function"?f=a.ownKeys:Object.getOwnPropertySymbols?f=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:f=function(e){return Object.getOwnPropertyNames(e)};function p(t){}var h=Number.isNaN||function(e){return e!==e};function i(){i.init.call(this)}c.exports=i,c.exports.once=K,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var g=10;function w(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(t){if(typeof t!="number"||t<0||h(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");g=t}}),i.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||h(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function _(t){return t._maxListeners===void 0?i.defaultMaxListeners:t._maxListeners}i.prototype.getMaxListeners=function(){return _(this)},i.prototype.emit=function(e){for(var n=[],o=1;o<arguments.length;o++)n.push(arguments[o]);var s=e==="error",d=this._events;if(d!==void 0)s=s&&d.error===void 0;else if(!s)return!1;if(s){var l;if(n.length>0&&(l=n[0]),l instanceof Error)throw l;var y=new Error("Unhandled error."+(l?" ("+l.message+")":""));throw y.context=l,y}var b=d[e];if(b===void 0)return!1;if(typeof b=="function")u(b,this,n);else for(var P=b.length,V=I(b,P),o=0;o<P;++o)u(V[o],this,n);return!0};function S(t,e,n,o){var s,d,l;if(w(n),d=t._events,d===void 0?(d=t._events=Object.create(null),t._eventsCount=0):(d.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),d=t._events),l=d[e]),l===void 0)l=d[e]=n,++t._eventsCount;else if(typeof l=="function"?l=d[e]=o?[n,l]:[l,n]:o?l.unshift(n):l.push(n),s=_(t),s>0&&l.length>s&&!l.warned){l.warned=!0;var y=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");y.name="MaxListenersExceededWarning",y.emitter=t,y.type=e,y.count=l.length}return t}i.prototype.addListener=function(e,n){return S(this,e,n,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,n){return S(this,e,n,!0)};function z(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function T(t,e,n){var o={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},s=z.bind(o);return s.listener=n,o.wrapFn=s,s}i.prototype.once=function(e,n){return w(n),this.on(e,T(this,e,n)),this},i.prototype.prependOnceListener=function(e,n){return w(n),this.prependListener(e,T(this,e,n)),this},i.prototype.removeListener=function(e,n){var o,s,d,l,y;if(w(n),s=this._events,s===void 0)return this;if(o=s[e],o===void 0)return this;if(o===n||o.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,o.listener||n));else if(typeof o!="function"){for(d=-1,l=o.length-1;l>=0;l--)if(o[l]===n||o[l].listener===n){y=o[l].listener,d=l;break}if(d<0)return this;d===0?o.shift():j(o,d),o.length===1&&(s[e]=o[0]),s.removeListener!==void 0&&this.emit("removeListener",e,y||n)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var n,o=this._events,s;if(o===void 0)return this;if(o.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):o[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete o[e]),this;if(arguments.length===0){var d=Object.keys(o),l;for(s=0;s<d.length;++s)l=d[s],l!=="removeListener"&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=o[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(s=n.length-1;s>=0;s--)this.removeListener(e,n[s]);return this};function U(t,e,n){var o=t._events;if(o===void 0)return[];var s=o[e];return s===void 0?[]:typeof s=="function"?n?[s.listener||s]:[s]:n?F(s):I(s,s.length)}i.prototype.listeners=function(e){return U(this,e,!0)},i.prototype.rawListeners=function(e){return U(this,e,!1)},i.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):E.call(t,e)},i.prototype.listenerCount=E;function E(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}i.prototype.eventNames=function(){return this._eventsCount>0?f(this._events):[]};function I(t,e){for(var n=new Array(e),o=0;o<e;++o)n[o]=t[o];return n}function j(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function F(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function K(t,e){return new Promise(function(n,o){function s(l){t.removeListener(e,d),o(l)}function d(){typeof t.removeListener=="function"&&t.removeListener("error",s),n([].slice.call(arguments))}B(t,e,d,{once:!0}),e!=="error"&&q(t,s,{once:!0})})}function q(t,e,n){typeof t.on=="function"&&B(t,"error",e,n)}function B(t,e,n,o){if(typeof t.on=="function")o.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function s(d){o.once&&t.removeEventListener(e,s),n(d)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}}}),$=R(H());const J="transport";var oe=class{exchangeTimeout=3e4;unresponsiveTimeout=15e3;deviceModel=null;tracer;constructor({context:r,logType:c}={}){this.tracer=new W(c??J,r)}static isSupported;static list;static listen;static open;exchange(r,{abortTimeoutMs:c}={}){throw new Error("exchange not implemented")}exchangeBulk(r,c){let a=!1;const u=()=>{a=!0};return(async()=>{if(!a)for(const p of r){const h=await this.exchange(p);if(a)return;const i=h.readUInt16BE(h.length-2);if(i!==M.OK)throw new A(i);c.next(h)}})().then(()=>!a&&c.complete(),p=>!a&&c.error(p)),{unsubscribe:u}}setScrambleKey(r){}close(){return Promise.resolve()}_events=new $.default;on(r,c){this._events.on(r,c)}off(r,c){this._events.removeListener(r,c)}emit(r,...c){this._events.emit(r,...c)}setDebugMode(){}setExchangeTimeout(r){this.exchangeTimeout=r}setExchangeUnresponsiveTimeout(r){this.unresponsiveTimeout=r}send=async(r,c,a,u,f=m.Buffer.alloc(0),p=[M.OK],{abortTimeoutMs:h}={})=>{const i=this.tracer.withUpdatedContext({function:"send"});if(f.length>=256)throw i.trace("data.length exceeded 256 bytes limit",{dataLength:f.length}),new L("data.length exceed 256 bytes limit. Got: "+f.length,"DataLengthTooBig");const g=await this.exchange(m.Buffer.concat([m.Buffer.from([r,c,a,u]),m.Buffer.from([f.length]),f]),{abortTimeoutMs:h}),w=g.readUInt16BE(g.length-2);if(!p.some(_=>_===w))throw new A(w);return g};static create(r=3e3,c){return new Promise((a,u)=>{let f=!1;const p=this.listen({next:i=>{f=!0,p&&p.unsubscribe(),h&&clearTimeout(h),this.open(i.descriptor,r).then(a,u)},error:i=>{h&&clearTimeout(h),u(i)},complete:()=>{h&&clearTimeout(h),f||u(new L(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),h=c?setTimeout(()=>{p.unsubscribe(),u(new L(this.ErrorMessage_ListenTimeout,"ListenTimeout"))},c):null})}exchangeBusyPromise;async exchangeAtomicImpl(r){const c=this.tracer.withUpdatedContext({function:"exchangeAtomicImpl",unresponsiveTimeout:this.unresponsiveTimeout});if(this.exchangeBusyPromise)throw c.trace("Atomic exchange is already busy"),new X("An action was already pending on the Ledger device. Please deny or reconnect.");let a;this.exchangeBusyPromise=new Promise(p=>{a=p});let u=!1;const f=setTimeout(()=>{c.trace('Timeout reached, emitting Transport event "unresponsive"',{unresponsiveTimeout:this.unresponsiveTimeout}),u=!0,this.emit("unresponsive")},this.unresponsiveTimeout);try{const p=await r();return u&&(c.trace("Device was unresponsive, emitting responsive"),this.emit("responsive")),p}finally{c.trace("Finalize, clearing busy guard"),clearTimeout(f),a&&a(),this.exchangeBusyPromise=null}}decorateAppAPIMethods(r,c,a){for(const u of c)r[u]=this.decorateAppAPIMethod(u,r[u],r,a)}_appAPIlock=null;decorateAppAPIMethod(r,c,a,u){return async(...f)=>{const{_appAPIlock:p}=this;if(p)return Promise.reject(new L("Ledger Device is busy (lock "+p+")","TransportLocked"));try{return this._appAPIlock=r,this.setScrambleKey(u),await c.apply(a,f)}finally{this._appAPIlock=null}}}setTraceContext(r){this.tracer=this.tracer.withContext(r)}updateTraceContext(r){this.tracer.updateContext(r)}getTraceContext(){return this.tracer.getContext()}static ErrorMessage_ListenTimeout="No Ledger device found (timeout)";static ErrorMessage_NoDeviceFound="No Ledger device found"};const O=5;function Y(r){const c=m.Buffer.alloc(2);return c.writeUInt16BE(r,0),c}const Q={data:m.Buffer.alloc(0),dataLength:0,sequence:0},Z=(r,c)=>({makeBlocks(a){let u=m.Buffer.concat([Y(a.length),a]);const f=c-5,p=Math.ceil(u.length/f);u=m.Buffer.concat([u,m.Buffer.alloc(p*f-u.length+1).fill(0)]);const h=[];for(let i=0;i<p;i++){const g=m.Buffer.alloc(5);g.writeUInt16BE(r,0),g.writeUInt8(O,2),g.writeUInt16BE(i,3);const w=u.slice(i*f,(i+1)*f);h.push(m.Buffer.concat([g,w]))}return h},reduceResponse(a,u){let{data:f,dataLength:p,sequence:h}=a||Q;if(u.readUInt16BE(0)!==r)throw new L("Invalid channel","InvalidChannel");if(u.readUInt8(2)!==O)throw new L("Invalid tag","InvalidTag");if(u.readUInt16BE(3)!==h)throw new L("Invalid sequence","InvalidSequence");a||(p=u.readUInt16BE(5)),h++;const i=u.slice(a?5:7);return f=m.Buffer.concat([f,i]),f.length>p&&(f=f.slice(0,p)),{data:f,dataLength:p,sequence:h}},getReducedResult(a){if(a&&a.dataLength===a.data.length)return a.data}});var ie=Z,N=R(G()),v;(function(r){r.blue="blue",r.nanoS="nanoS",r.nanoSP="nanoSP",r.nanoX="nanoX",r.stax="stax",r.europa="europa",r.apex="apex"})(v||(v={}));const x={[v.blue]:{id:v.blue,productName:"Ledger Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:480*1024,masks:[822083584,822149120],getBlockSize:r=>4*1024},[v.nanoS]:{id:v.nanoS,productName:"Ledger Nano S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:320*1024,masks:[823132160],getBlockSize:r=>N.default.lt(N.default.coerce(r)??"","2.0.0")?4*1024:2*1024},[v.nanoX]:{id:v.nanoX,productName:"Ledger Nano X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2*1024*1024,masks:[855638016],getBlockSize:r=>4*1024,bluetoothSpec:[{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-0004-0003-4c6564676572"}]},[v.nanoSP]:{id:v.nanoSP,productName:"Ledger Nano S Plus",productIdMM:80,legacyUsbProductId:5,usbOnly:!0,memorySize:1533*1024,masks:[856686592],getBlockSize:r=>32},[v.apex]:{id:v.apex,productName:"Ledger Nano Gen5",productIdMM:128,legacyUsbProductId:8,usbOnly:!1,memorySize:1533*1024,masks:[859832320],getBlockSize:r=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-8004-0000-4c6564676572",notifyUuid:"13d63400-2c97-8004-0001-4c6564676572",writeUuid:"13d63400-2c97-8004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-8004-0003-4c6564676572"}]},[v.stax]:{id:v.stax,productName:"Ledger Stax",productIdMM:96,legacyUsbProductId:6,usbOnly:!1,memorySize:1533*1024,masks:[857735168],getBlockSize:r=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-6004-0000-4c6564676572",notifyUuid:"13d63400-2c97-6004-0001-4c6564676572",writeUuid:"13d63400-2c97-6004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-6004-0003-4c6564676572"}]},[v.europa]:{id:v.europa,productName:"Ledger Flex",productIdMM:112,legacyUsbProductId:7,usbOnly:!1,memorySize:1533*1024,masks:[858783744],getBlockSize:r=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-3004-0000-4c6564676572",notifyUuid:"13d63400-2c97-3004-0001-4c6564676572",writeUuid:"13d63400-2c97-3004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-3004-0003-4c6564676572"}]}};v.blue,v.nanoS,v.nanoSP,v.nanoX,v.stax,v.europa;const C=Object.values(x),se=11415,ae=r=>{const c=C.find(u=>u.legacyUsbProductId===r);if(c)return c;const a=r>>8;return C.find(u=>u.productIdMM===a)},ee=[],k={};for(const r in x){const c=x[r],{bluetoothSpec:a}=c;if(a)for(let u=0;u<a.length;u++){const f=a[u];ee.push(f.serviceUuid),k[f.serviceUuid]=k[f.serviceUuid.replace(/-/g,"")]={deviceModel:c,...f}}}export{oe as T,ie as h,ae as i,se as l};
