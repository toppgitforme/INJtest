import{x as u,K as E,M as f,L as q,O as U,N,R as D,P as j,e as s,U as o,T as H}from"./injective-utils-C9MYzl-J.js";import{a as Y,b as Q,W as r,c as V,d as w,e as l,g as J,f as X}from"./wallet-core-CdETWVBX.js";import{b6 as Z,b7 as ee,b8 as te,aQ as ne,b9 as ie}from"./injective-sdk-yGcRIHv8.js";import"./icons-Dj0zHVqu.js";import"./injective-networks-BywkriB7.js";const b=()=>typeof window>"u"?{}:window;async function re({timeout:e}={timeout:3e3}){const t=W();return t||oe({timeout:e})}async function oe({timeout:e}={timeout:3e3}){return new Promise(t=>{const n=()=>{t(W())},i=b();i.addEventListener("rabby#initialized",n,{once:!0}),setTimeout(()=>{i.removeEventListener("rabby#initialized",n),t(null)},e)})}function W(){const e=b();if(typeof window<"u"&&typeof e.ethereum<"u"){if(e.ethereum.isRabby)return e.ethereum;if(e.providers)return e.providers.find(t=>t.isRabby)}}const P=()=>typeof window>"u"?{}:window;async function ae({timeout:e}={timeout:3e3}){const t=C();return t||se({timeout:e})}async function se({timeout:e}={timeout:3e3}){return new Promise(t=>{const n=()=>{t(C())},i=P();i.addEventListener("okxwallet#initialized",n,{once:!0}),setTimeout(()=>{i.removeEventListener("okxwallet#initialized",n),t(null)},e)})}function C(){const e=P();if(typeof window<"u"&&(typeof e.ethereum<"u"||typeof e.okxwallet<"u")){if(e.okxwallet)return e.okxwallet;if(e.ethereum.isOkxWallet)return e.ethereum;if(e.providers)return e.providers.find(t=>t.isOkxWallet)}}const x=()=>typeof window>"u"?{}:window;async function le({timeout:e}={timeout:3e3}){const t=T();return t||de({timeout:e})}async function de({timeout:e}={timeout:3e3}){return new Promise(t=>{const n=()=>{t(T())},i=x();i.addEventListener("bitkeep#initialized",n,{once:!0}),setTimeout(()=>{i.removeEventListener("bitkeep#initialized",n),t(null)},e)})}function T(){const e=x();if(typeof window<"u"&&(typeof e.ethereum<"u"||typeof e.bitkeep<"u")&&e.bitkeep&&e.bitkeep.ethereum)return e.bitkeep.ethereum}const k=()=>typeof window>"u"?{}:window;async function ue({timeout:e}={timeout:3e3}){const t=I();return t||ce({timeout:e})}async function ce({timeout:e}={timeout:3e3}){return new Promise(t=>{const n=()=>{t(I())},i=k();i.addEventListener("phantom#initialized",n,{once:!0}),setTimeout(()=>{i.removeEventListener("phantom#initialized",n),t(null)},e)})}function I(){const e=k();if(typeof window<"u"&&(typeof e.ethereum<"u"||typeof e.phantom<"u")){if(e.phantom)return e.phantom.ethereum;if(e.ethereum.isPhantom)return e.ethereum;if(e.providers)return e.providers.find(t=>t.isPhantom)}}const L=()=>typeof window>"u"?{}:window;async function we({timeout:e}={timeout:3e3}){const t=z();return t||me({timeout:e})}async function me({timeout:e}={timeout:3e3}){return new Promise(t=>{const n=()=>{t(z())},i=L();i.addEventListener("ethereum#initialized",n,{once:!0}),setTimeout(()=>{i.removeEventListener("ethereum#initialized",n),t(null)},e)})}function z(){const e=L();if(typeof window<"u"&&typeof e.ethereum<"u"){if(e.ethereum.isMetaMask)return e.ethereum;if(e.providers)return e.providers.find(t=>t.isMetaMask)}}const $=()=>typeof window>"u"?{}:window;async function he({timeout:e}={timeout:3e3}){const t=M();return t||fe({timeout:e})}async function fe({timeout:e}={timeout:3e3}){return new Promise(t=>{const n=()=>{t(M())},i=$();i.addEventListener("trustwallet#initialized",n,{once:!0}),setTimeout(()=>{i.removeEventListener("trustwallet#initialized",n),t(null)},e)})}function M(){const e=$();if(typeof window<"u"&&(typeof e.ethereum<"u"||typeof e.trustWallet<"u")){if(e.trustWallet)return e.trustWallet;if(e.ethereum.isTrustWallet||e.ethereum.isTrust)return e.ethereum;if(e.providers)return e.providers.find(t=>t.isTrustWallet)}}const R=()=>typeof window>"u"?{}:window;async function pe({timeout:e}={timeout:3e3}){const t=S();return t||ve({timeout:e})}async function ve({timeout:e}={timeout:3e3}){return new Promise(t=>{const n=()=>{t(S())},i=R();i.addEventListener("rainbow#initialized",n,{once:!0}),setTimeout(()=>{i.removeEventListener("rainbow#initialized",n),t(null)},e)})}function S(){const e=R();if(typeof window<"u"&&(typeof e.ethereum<"u"||typeof e.rainbow<"u")){if(e.rainbow)return e.rainbow;if(e.ethereum.isRainbow)return e.ethereum;if(e.providers)return e.providers.find(t=>t.isRainbow)}}const F=()=>typeof window>"u"?{}:window;async function ye({timeout:e}={timeout:3e3}){const t=A();return t||Ee({timeout:e})}async function Ee({timeout:e}={timeout:3e3}){return new Promise(t=>{const n=()=>{t(A())},i=F();i.addEventListener("keplr#initialized",n,{once:!0}),setTimeout(()=>{i.removeEventListener("keplr#initialized",n),t(null)},e)})}function A(){var e,t,n;const i=F();if(typeof window<"u"&&(typeof i.ethereum<"u"||typeof((e=i.keplr)===null||e===void 0?void 0:e.ethereum)<"u")){if(!((t=i.keplr)===null||t===void 0)&&t.ethereum)return i.keplr.ethereum;if(!((n=i.ethereum)===null||n===void 0)&&n.isKeplr)return i.ethereum;if(i.providers)return i.providers.find(a=>a.isKeplr)}}function h(e){"@babel/helpers - typeof";return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(e)}function ge(e,t){if(h(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t);if(h(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function be(e){var t=ge(e,"string");return h(t)=="symbol"?t:t+""}function g(e,t,n){return(t=be(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ke=class extends Y{constructor(e){if(super(e),g(this,"wallet",void 0),g(this,"evmProviders",{}),!Q(e.wallet))throw new u(new Error(`Evm Wallet for ${E(e.wallet)} is not supported.`));Z()||(window.addEventListener("eip6963:announceProvider",t=>{const n=t,i=n.detail.info.name.toLowerCase();i==="keplr"&&(this.evmProviders[r.KeplrEvm]=n.detail.provider),i===r.Metamask.toLowerCase()&&(this.evmProviders[r.Metamask]=n.detail.provider),i===r.Rabby.toLowerCase()&&(this.evmProviders[r.Rabby]=n.detail.provider),i===r.Rainbow.toLowerCase()&&(this.evmProviders[r.Rainbow]=n.detail.provider),i===r.Phantom.toLowerCase()&&(this.evmProviders[r.Phantom]=n.detail.provider),i===r.OkxWallet.toLowerCase()&&(this.evmProviders[r.OkxWallet]=n.detail.provider),i===r.BitGet.toLowerCase()&&(this.evmProviders[r.BitGet]=n.detail.provider),i===r.TrustWallet.toLowerCase()&&(this.evmProviders[r.TrustWallet]=n.detail.provider)}),window.dispatchEvent(new Event("eip6963:requestProvider"))),this.wallet=e.wallet}EvmWalletException(e,t){return this.wallet===r.Metamask?new f(e,t):this.wallet===r.BitGet?new q(e,t):this.wallet===r.OkxWallet?new U(e,t):this.wallet===r.Phantom?new f(e,t):this.wallet===r.TrustWallet?new N(e,t):this.wallet===r.Rainbow?new D(e,t):this.wallet===r.KeplrEvm?new j(e,t):new u(e,t)}async getWalletDeviceType(){return Promise.resolve(V.Browser)}async enable(){return Promise.resolve(!0)}async disconnect(){this.listeners[w.AccountChange]&&(await this.getEthereum()).removeListener("accountsChanged",this.listeners[w.AccountChange]),this.listeners[w.ChainIdChange]&&(await this.getEthereum()).removeListener("chainChanged",this.listeners[w.ChainIdChange]),this.listeners={}}async getAddresses(){const e=await this.getEthereum();try{return await e.request({method:"eth_requestAccounts"})}catch(t){throw this.EvmWalletException(new Error(t.message),{code:o,type:s.WalletError,contextModule:l.GetAccounts})}}async getAddressesInfo(){throw new u(new Error("getAddressesInfo is not implemented"),{code:o,type:s.WalletError,contextModule:l.GetAccounts})}async getSessionOrConfirm(e){return Promise.resolve(`0x${ee(te(`Confirmation for ${e} at time: ${Date.now()}`))}`)}async sendEvmTransaction(e,t){const n=await this.getEthereum();try{return await n.request({method:"eth_sendTransaction",params:[e]})}catch(i){throw this.EvmWalletException(new Error(i.message),{code:o,type:s.WalletError,contextModule:l.SendEvmTransaction})}}async sendTransaction(e,t){const{endpoints:n,txTimeout:i}=t;if(!n)throw new u(new Error("You have to pass endpoints within the options for using Ethereum native wallets"));const a=await new ne(n.grpc).broadcast(e,{txTimeout:i});if(a.code!==0)throw new H(new Error(a.rawLog),{code:o,contextCode:a.code,contextModule:a.codespace});return a}async signEip712TypedData(e,t){const n=await this.getEthereum();try{return await n.request({method:"eth_signTypedData_v4",params:[t,e]})}catch(i){throw i.message.includes("Ledger: The signature doesnt match the right address")?new f(new Error("Please connect directly with Ledger to sign this transaction"),{code:o,type:s.WalletError,contextModule:l.SignTransaction}):new f(new Error(i.message),{code:o,type:s.WalletError,contextModule:l.SignTransaction})}}async signAminoCosmosTransaction(e){throw new u(new Error("This wallet does not support signing Cosmos transactions"),{code:o,type:s.WalletError,contextModule:l.SignTransaction})}async signCosmosTransaction(e){throw new u(new Error("This wallet does not support signing Cosmos transactions"),{code:o,type:s.WalletError,contextModule:l.SignTransaction})}async signArbitrary(e,t){const n=await this.getEthereum();try{return await n.request({method:"personal_sign",params:[ie(t),e]})}catch(i){throw this.EvmWalletException(new Error(i.message),{code:o,type:s.WalletError,contextModule:l.SignArbitrary})}}async getEthereumChainId(){const e=await this.getEthereum();try{return e.request({method:"eth_chainId"})}catch(t){throw this.EvmWalletException(new Error(t.message),{code:o,type:s.WalletError,contextModule:l.GetChainId})}}async getEvmTransactionReceipt(e){const t=await this.getEthereum(),n=await t.request({method:"eth_chainId"}),i=J(parseInt(n,16),t);try{return await i.waitForTransactionReceipt({hash:e,timeout:3e4,pollingInterval:3e3}),e}catch{throw new Error(`Failed to retrieve transaction receipt for txHash: ${e}`)}}async getPubKey(){throw new u(new Error("You can only fetch PubKey from Cosmos native wallets"))}async onChainIdChanged(e){const t=await this.getEthereum();this.listeners={[w.ChainIdChange]:e},t.on("chainChanged",e)}async onAccountChange(e){const t=await this.getEthereum();this.listeners={[w.AccountChange]:e},t.on("accountsChanged",e)}async getEip1193Provider(){return this.getEthereum()}async addEvmNetwork(e){var t,n;const i=await this.getEthereum(),a=`0x${e.toString(16)}`,m=X(e),G={chainId:a,chainName:m.name,rpcUrls:[...((t=m.rpcUrls)===null||t===void 0||(t=t.default)===null||t===void 0?void 0:t.http)||[]],blockExplorerUrls:!((n=m.blockExplorers)===null||n===void 0||(n=n.default)===null||n===void 0)&&n.url?[m.blockExplorers.default.url]:[],nativeCurrency:m.nativeCurrency},O=3e4;try{await Promise.race([i.request({method:"wallet_switchEthereumChain",params:[{chainId:a}]}),new Promise((d,_)=>{const v=B=>{B.toLowerCase()===a.toLowerCase()&&(y(),d())},K=setTimeout(()=>{y(),_(new Error("Chain switch timed out"))},O),y=()=>{i.removeListener("chainChanged",v),clearTimeout(K)};i.on("chainChanged",v)})])}catch(d){var p,c;if(((p=d.code)!==null&&p!==void 0?p:d==null||(c=d.data)===null||c===void 0||(c=c.originalError)===null||c===void 0?void 0:c.code)===4902){await i.request({method:"wallet_addEthereumChain",params:[G]});return}throw d.message==="Chain switch timed out"?this.EvmWalletException(new Error("Chain switch timed out"),{code:o,type:s.WalletError,contextModule:l.GetChainId}):this.EvmWalletException(new Error(`Something went wrong while adding ${E(this.wallet||"wallet")} network`),{code:o,type:s.WalletError,contextModule:l.GetChainId})}}async getEthereum(){const e=this.evmProviders[this.wallet];if(e)return e;const t=this.wallet===r.Metamask?await we():this.wallet===r.Rabby?await re():this.wallet===r.Phantom?await ue():this.wallet===r.BitGet?await le():this.wallet===r.OkxWallet?await ae():this.wallet===r.TrustWallet?await he():this.wallet===r.Rainbow?await pe():this.wallet===r.KeplrEvm?await ye():void 0;if(!t)throw this.EvmWalletException(new Error(`Please install the ${this.wallet} wallet extension.`),{code:o,type:s.WalletNotInstalledError,contextModule:l.GetAccounts});return t}};export{ke as EvmWalletStrategy,le as getBitGetProvider,ye as getKeplrEvmProvider,we as getMetamaskProvider,ae as getOkxWalletProvider,ue as getPhantomProvider,re as getRabbyProvider,pe as getRainbowProvider,he as getTrustWalletProvider};
